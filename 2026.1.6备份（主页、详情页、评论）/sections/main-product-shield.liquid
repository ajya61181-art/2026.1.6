{% comment %}
  Main product shield PDP
{% endcomment %}

{{ 'lanomiz-shield-pdp.css' | asset_url | stylesheet_tag }}

<section class="product-hero">
  <div class="product-hero-container">

    <!-- Gallery -->
    <div class="product-gallery">
      <div class="product-thumbnails">
        {% for media in product.media limit: 4 %}
          {% if media.media_type == 'image' %}
            <div class="product-thumbnail {% if forloop.first %}active{% endif %}">
              {{ media | image_url: width: 200 | image_tag: alt: media.alt | escape }}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="product-main-image">
        <button class="zoom-btn" type="button">ğŸ”</button>

        {% if product.featured_image %}
          {{ product.featured_image | image_url: width: 900 | image_tag: alt: product.title }}
        {% endif %}

        <p class="product-disclaimer">
          * These statements have not been evaluated by the Food and Drug Administration. This product is not intended to diagnose, treat, cure, or prevent any disease.
        </p>
      </div>
    </div>

    <!-- Info -->
    <div class="product-info">

      <!-- âœ… Judge.me rating badge (click to reviews) -->
      <div class="product-rating">
        <a href="#reviews" class="lemme-rating">
          <div class="jdgm-widget jdgm-preview-badge" data-id="{{ product.id }}">
            {%- if product.metafields.jdgm.preview_badge != blank -%}
              {{ product.metafields.jdgm.preview_badge }}
            {%- endif -%}
          </div>
        </a>
      </div>

      <h1 class="product-title">{{ product.title }}</h1>

      <p class="product-subtitle">
        {% if product.metafields.custom.subtitle != blank %}
          {{ product.metafields.custom.subtitle }}
        {% else %}
          Metabolic Support Complex*
        {% endif %}
      </p>

      <!-- Purchase / Add to cart -->
      {% form 'product', product, id: 'shieldProductForm' %}

        <div class="purchase-options">
          {% for v in product.variants %}
            <label class="purchase-option {% if v.id == product.selected_or_first_available_variant.id %}selected{% endif %}">
              <input
                type="radio"
                name="id"
                value="{{ v.id }}"
                {% if v.id == product.selected_or_first_available_variant.id %}checked{% endif %}
                style="display:none;"
              >

              <div class="purchase-option-left">
                <div class="purchase-radio"></div>
                <div class="purchase-option-info">
                  <h4>{{ v.title }}</h4>
                </div>
              </div>

              <div class="purchase-option-right">
                <span class="sale-price" data-price="{{ v.price }}">{{ v.price | money_without_trailing_zeros }}</span>

                {% if v.compare_at_price > v.price %}
                  <span class="original-price">{{ v.compare_at_price | money_without_trailing_zeros }}</span>
                  {% assign off = v.compare_at_price | minus: v.price | times: 100 | divided_by: v.compare_at_price %}
                  <span class="discount-badge">{{ off }}% OFF</span>
                {% endif %}
              </div>
            </label>
          {% endfor %}
        </div>

        <button class="add-to-cart-btn" type="submit" {% unless product.available %}disabled{% endunless %}>
          <span class="btn-price">{{ product.selected_or_first_available_variant.price | money_without_trailing_zeros }}</span> â€“ ADD TO BAG
        </button>

      {% endform %}

      <script>
        document.addEventListener('change', function(e){
          if (e.target && e.target.name === 'id') {
            document.querySelectorAll('#shieldProductForm .purchase-option')
              .forEach(el => el.classList.remove('selected'));

            const option = e.target.closest('.purchase-option');
            if (!option) return;

            option.classList.add('selected');

            const priceEl = option.querySelector('.sale-price');
            const btnPrice = document.querySelector('#shieldProductForm .btn-price');
            if (priceEl && btnPrice) btnPrice.textContent = priceEl.textContent;
          }
        });
      </script>

    </div>
  </div>
</section>


<!-- âœ… Reviews -->
<section id="reviews" class="lemme-reviews">
  <div class="lemme-reviews__container">

    <div class="lemme-reviews__header">
      <div class="lemme-reviews__left">
        <h2 class="lemme-reviews__title">Reviews</h2>
      </div>
    </div>

    <!-- âœ… Featured 5-star testimonials (static, Lemme-style) -->
    <div class="featured-reviews">
      <div class="featured-reviews__grid">
        <article class="fr-card">
          <div class="fr-top">
            <div class="fr-stars" aria-label="5 stars">â˜…â˜…â˜…â˜…â˜…</div>
            <div class="fr-badge">Verified-style</div>
          </div>
          <h3 class="fr-title">No more sugar crash.</h3>
          <p class="fr-text">I take it before carb-heavy meals and the difference is noticeableâ€”steady energy, no afternoon slump.</p>
          <div class="fr-meta">â€” Mia Â· 30-day routine</div>
        </article>

        <article class="fr-card">
          <div class="fr-top">
            <div class="fr-stars" aria-label="5 stars">â˜…â˜…â˜…â˜…â˜…</div>
            <div class="fr-badge">5.0</div>
          </div>
          <h3 class="fr-title">Works best with consistency.</h3>
          <p class="fr-text">Week 2â€“3 was the turning point. I feel lighter after meals and cravings feel easier to manage.</p>
          <div class="fr-meta">â€” Jasmine Â· Repeat buyer</div>
        </article>

        <article class="fr-card">
          <div class="fr-top">
            <div class="fr-stars" aria-label="5 stars">â˜…â˜…â˜…â˜…â˜…</div>
            <div class="fr-badge">Top pick</div>
          </div>
          <h3 class="fr-title">Gentle, no weird side effects.</h3>
          <p class="fr-text">No jitters, no stomach issues for me. Just feels like better control around carbs.</p>
          <div class="fr-meta">â€” Leah Â· Sensitive stomach</div>
        </article>

        <article class="fr-card">
          <div class="fr-top">
            <div class="fr-stars" aria-label="5 stars">â˜…â˜…â˜…â˜…â˜…</div>
            <div class="fr-badge">Loved</div>
          </div>
          <h3 class="fr-title">The â€œbefore mealâ€ ritual is easy.</h3>
          <p class="fr-text">Two capsules and Iâ€™m done. It fits my day and makes me feel more confident ordering what I want.</p>
          <div class="fr-meta">â€” Ava Â· Busy schedule</div>
        </article>
      </div>

      <p class="featured-reviews__note">
        * Sample testimonials for design preview. Judge.me reviews below reflect verified customer submissions once collected.
      </p>
    </div>

    <!-- âœ… Judge.me REAL widgetï¼ˆç”¨æˆ·å†™çš„è¯„è®ºä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œï¼‰ -->
    <div class="jdgm-widget jdgm-review-widget" data-id="{{ product.id }}" data-product-id="{{ product.id }}">
      {{ product.metafields.jdgm.widget }}
    </div>

  </div>

  <style>
    /* âœ… å…³é”®ï¼šä¸è¦éšè— jdgm-write-rev-linkï¼ˆå¦åˆ™å³è¾¹æŒ‰é’®æ²¡äº†ï¼‰ */

    /* è®© â€œBe the firstâ€¦â€ ä¸å³ä¾§æŒ‰é’®å‘ˆä¸¤åˆ—ï¼Œå¹¶åœ¨å³ä¾§å‡ºç°ç«–çº¿ */
    #reviews .jdgm-rev-widg__no-rev {
      max-width: 520px;
    }

    /* Judge.me å³ä¾§æŒ‰é’®å®¹å™¨ï¼šç«–çº¿å³è¾¹ã€å±…ä¸­ */
    #reviews .jdgm-widget-actions-wrapper {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      padding-left: 24px !important;
      border-left: 1px solid rgba(0,0,0,0.12) !important; /* ç«–çº¿ */
      min-height: 120px;
    }

    /* æŠŠ Judge.me é»˜è®¤çš„é“¾æ¥æŒ‰é’®åšæˆä½ ç°åœ¨çš„ pill æ ·å¼ */
    #reviews .jdgm-widget-actions-wrapper .jdgm-write-rev-link {
      border: 2px solid #000 !important;
      background: #fff !important;
      color: #000 !important;
      padding: 14px 22px !important;
      border-radius: 9999px !important;
      font-weight: 700 !important;
      text-transform: uppercase !important;
      letter-spacing: .08em !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      text-decoration: none !important;
      white-space: nowrap !important;
    }
    #reviews .jdgm-widget-actions-wrapper .jdgm-write-rev-link:hover {
      background: #000 !important;
      color: #fff !important;
    }
  </style>

  <script>
    (function () {
      const root = document.getElementById('reviews');
      if (!root) return;

      // åœ¨ç¼–è¾‘å™¨ iframe é‡Œï¼ŒJudge.me å¼¹çª—å¸¸è¢«é™åˆ¶/è¢«æ‹¦æˆªï¼Œ
      // è¿™é‡Œåšä¸€ä¸ªâ€œå…œåº•â€ï¼šç‚¹å‡»åå¦‚æœå¼¹çª—æ²¡å¼€ï¼Œå°±æ–°å¼€çœŸå®é¢„è§ˆé¡µåˆ° #reviews
      function bindWriteReviewFallback() {
        const btn = root.querySelector('.jdgm-widget-actions-wrapper .jdgm-write-rev-link');
        if (!btn) return;

        // é˜²æ­¢é‡å¤ç»‘å®š
        if (btn.dataset.bound === '1') return;
        btn.dataset.bound = '1';

        btn.addEventListener('click', function () {
          // å…è®¸ Judge.me è‡ªå·±çš„ click é€»è¾‘å…ˆè·‘
          setTimeout(function () {
            const inIframe = window.self !== window.top;
            if (!inIframe) return;

            // ç¼–è¾‘å™¨é‡Œï¼šæ–°å¼€çœŸå®é¡µé¢ï¼ˆä½ ä¼šçœ‹åˆ° Judge.me çš„è¡¨å•/å¼¹çª—æ­£å¸¸ï¼‰
            const url = "{{ product.url | within: collection }}";
            const full = window.location.origin + url + "#reviews";
            window.open(full, "_blank");
          }, 250);
        }, true);
      }

      // Judge.me å¼‚æ­¥åŠ è½½ï¼šè½®è¯¢ + è§‚å¯Ÿè€…
      let tries = 0;
      const timer = setInterval(() => {
        tries++;
        bindWriteReviewFallback();
        if (root.querySelector('.jdgm-widget-actions-wrapper .jdgm-write-rev-link') || tries > 60) {
          clearInterval(timer);
        }
      }, 200);

      const mo = new MutationObserver(() => bindWriteReviewFallback());
      mo.observe(root, { childList: true, subtree: true });
    })();
  </script>
</section>


{% schema %}
{
  "name": "Main product - Shield",
  "settings": []
}
{% endschema %}
